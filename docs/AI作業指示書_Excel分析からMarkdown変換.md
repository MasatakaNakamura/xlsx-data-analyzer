# AI作業指示書 - Excel分析からMarkdown変換プロセス

## 📋 作業概要

Excelファイルをzipとして展開・分析し、各シートの内容を人間が見やすいMarkdown形式に変換する作業の詳細手順書

**汎用性**: この手順書は様々なExcelファイル（経歴書、売上データ、在庫管理、プロジェクト管理表等）に対応可能な汎用的な設計となっています。

---

## 🎯 作業目標

- Excelファイル（経歴書等）の内容を構造化されたMarkdownドキュメントに変換
- 図表が必要な箇所はmermaid形式で作成
- 人間が理解しやすい形式での情報整理
- 分析結果の総合レポート作成

---

## 📂 前提条件

### 作業環境
- docsディレクトリへの書き込み権限
- mermaid図の作成能力
- 日本語での文書作成

### 📁 出力ディレクトリ規則
**重要**: AIが作成する全ての分析結果ファイルは `docs/result/` ディレクトリに保存すること

```
docs/
├── result/                              # 👈 AI作成ファイルの保存先
│   ├── excel_structure_analysis.md     # Excel構造分析
│   ├── [シート名1]_sheet.md             # 第1シート基本分析
│   ├── [シート名2]_sheet.md             # 第2シート基本分析
│   ├── [シート名3]_sheet.md             # 第3シート基本分析（構成図等）
│   ├── [シート名1]_詳細.md              # 第1シート詳細分析
│   ├── [シート名2]_詳細.md              # 第2シート詳細分析
│   ├── [シート名3]_詳細フローチャート.md # 構成図系シート詳細分析
│   └── [Excelファイル名]_総合分析レポート.md # 総合分析レポート
└── AI作業指示書_Excel分析からMarkdown変換.md  # 作業手順書（このファイル）
```

**ファイル命名規則**:
- `[シート名]`: Excelのワークシート名をそのまま使用
- `[Excelファイル名]`: 分析対象の.xlsxファイル名（拡張子なし）
- 日本語シート名の場合はそのまま使用、英数字は適宜変換

**ディレクトリ作成**: 作業開始前に `docs/result/` ディレクトリが存在しない場合は作成すること

---

## 🔄 作業フロー

### Phase 0: Excel解析・展開フェーズ（前処理）

#### Step 0-1: タスク管理の初期化（解析フェーズ）
```markdown
TodoWriteツールを使用して以下のタスクを設定：
0. docs/result/ディレクトリを作成（存在しない場合）
1. Excelファイルの拡張子を.xlsxから.zipに変換
2. zipファイルをunzipして展開
3. 展開されたディレクトリ構造を分析
4. excel_structure_analysis.mdを作成
5. 各シートのXX_sheet.mdファイルを作成
```

**重要**: 最初に `docs/result/` ディレクトリの存在確認と作成を必ず実行すること

#### Step 0-2: Excelファイルの拡張子変換【1番目のタスクを in_progress に設定】

**対象ファイル**: `*.xlsx`
**操作**: 拡張子を`.xlsx`から`.zip`に変更

```bash
# ファイル名例：経歴書サンプル.xlsx → 経歴書サンプル.zip
cp "経歴書サンプル.xlsx" "経歴書サンプル.zip"
```

**重要な注意事項**:
- ファイル名にスペースや日本語が含まれる場合は必ずクォートで囲む
- バックアップとして元ファイルのコピーを保持推奨
- 作業ディレクトリの確認を事前に実行

**完了後**: タスクをcompletedに変更

#### Step 0-3: zipファイルの展開【2番目のタスクを in_progress に設定】

**操作**: zipファイルを展開してディレクトリ構造を作成

```bash
# 展開先ディレクトリを作成
mkdir -p "展開用ディレクトリ"
# zipファイルを展開
unzip "経歴書サンプル.zip" -d "展開用ディレクトリ/"
```

**展開後の期待構造**:
```
展開用ディレクトリ/
├── [Content_Types].xml
├── _rels/
│   └── .rels
├── docProps/
│   ├── app.xml
│   ├── core.xml
│   └── custom.xml
└── xl/
    ├── _rels/
    ├── calcChain.xml
    ├── drawings/
    ├── sharedStrings.xml
    ├── styles.xml
    ├── workbook.xml
    └── worksheets/
        ├── sheet1.xml
        ├── sheet2.xml
        └── sheet3.xml
```

**完了後**: タスクをcompletedに変更

#### Step 0-4: ディレクトリ構造の分析【3番目のタスクを in_progress に設定】

**分析対象**:
1. **ルートディレクトリ構造**: `ls -la`で全体を確認
2. **xlディレクトリ**: `ls -la xl/`でExcel本体構造を確認
3. **worksheetsディレクトリ**: `ls -la xl/worksheets/`でシート一覧を確認
4. **共有文字列**: `xl/sharedStrings.xml`の内容確認
5. **ワークブック定義**: `xl/workbook.xml`でシート名・ID確認

**実行コマンド例**:
```bash
# ディレクトリ構造の確認
find "展開用ディレクトリ" -type f -name "*.xml" | head -20
# ワークシート一覧の確認
ls -la "展開用ディレクトリ/xl/worksheets/"
```

**完了後**: タスクをcompletedに変更

#### Step 0-5: excel_structure_analysis.md作成【4番目のタスクを in_progress に設定】

**出力ファイル**: `docs/result/excel_structure_analysis.md`

**必須含有要素**:
```markdown
# Excelファイル構造分析レポート - [ファイル名]

## 1. 概要
## 2. ファイル構造
### 2.1 ルートディレクトリ構造
### 2.2 Excelファイル構造図（Mermaid）
## 3. ドキュメント情報
### 3.1 基本情報（docProps/core.xml より）
### 3.2 アプリケーション情報（docProps/app.xml より）
### 3.3 ワークシート構成
## 4. 内容分析
### 4.1 共有文字列（sharedStrings.xml より抽出）
### 4.2 技術スタック構成図（Mermaid）
## 5. ワークシート詳細分析
## 6. 外部参照
## 7. まとめ
```

**重要なmermaid図**:
- ファイル構造図（graph TD形式）
- 技術スタック図（mindmap形式）
- プロセスフロー図（必要に応じて）

**完了後**: タスクをcompletedに変更

#### Step 0-6: 各シートファイルの作成【5番目のタスクを in_progress に設定】

**作成対象**: 各worksheet XMLファイルに対応するMarkdownファイル

**ファイル命名規則**:
- `sheet1.xml` → `docs/result/シート名_sheet.md`
- `sheet2.xml` → `docs/result/シート名_sheet.md`
- `sheet3.xml` → `docs/result/シート名_sheet.md`

**必須含有要素（各シートファイル）**:
```markdown
# [シート名]シート

## データ構造
- 表形式でのデータ表現
- 重要なセル値の抽出
- 数式・計算式の説明

## 特徴的な要素
- 条件付き書式
- データ検証
- 図形・グラフ（該当する場合）

## 業務的意味
- データの用途説明
- 関連するビジネスプロセス
```

**データ抽出方法**:
1. XMLファイルの`<c>`タグから値を抽出
2. `sharedStrings.xml`を参照して文字列を解決
3. 数式は`<f>`タグから取得
4. 表形式（Markdownテーブル）で整理

**完了後**: タスクをcompletedに変更

---

### Phase 1: 準備・分析フェーズ

#### Step 1-1: タスク管理の初期化（変換フェーズ）
```markdown
TodoWriteツールを使用して以下のタスクを設定：
1. 第1シートのデータを見やすいMarkdown形式で詳細整理
2. 第2シートのデータを見やすいMarkdown形式で詳細整理
3. 第3シート（構成図・フローチャート系）をmermaid形式で改善
4. 全体のサマリーとプロジェクト分析ドキュメントを作成

※ Phase 0で作成された基本ファイル（excel_structure_analysis.md, XX_sheet.md）が前提
※ シート数が3つ以外の場合は、実際のシート数に応じてタスクを調整
```

#### Step 1-2: 基準ファイルの確認
- `docs/20250927_001.md`を読み込み、作業対象を把握
- 既存のmarkdownファイル一覧を確認（mcp__serena__list_dir使用）

#### Step 1-3: 既存データの読み込み
Phase 0で作成された以下のファイルを並行して読み込み：
- `docs/result/excel_structure_analysis.md`
- `docs/result/[シート名1]_sheet.md`
- `docs/result/[シート名2]_sheet.md`
- `docs/result/[シート名3]_sheet.md`
- その他のシートファイル（シート数に応じて）

**重要**: 実際のシート名に置き換えて読み込むこと

---

### Phase 2: 個別シート変換フェーズ

#### Step 2-1: 第1シート詳細変換【最初のタスクを in_progress に設定】

**出力ファイル**: `docs/result/[シート名1]_詳細.md`

**必須含有要素**:
```markdown
# [シート名1] - 詳細分析

## 📋 基本情報
- 表形式での基本情報整理
- データ概要・特徴

## 💼 データ構造・内容
- 主要データを時系列または論理順序で詳細化
- システム概要、作業内容、技術情報などを構造化

## 📊 データ統計・可視化
- 関連するpieチャート（mermaid）
- データ構造のmindmap（mermaid）
- 時系列データのtimeline（mermaid）
```

**完了後**: タスクをcompletedに変更

#### Step 2-2: 第2シート詳細変換【2番目のタスクを in_progress に設定】

**出力ファイル**: `docs/result/[シート名2]_詳細.md`

**必須含有要素**:
```markdown
# [シート名2] - 詳細分析

## 📋 基本情報
## 💼 データ構造・内容
## 🔍 第1シートとの比較分析  ← 重要：比較表を作成
## 📊 データ統計・可視化
## 🚀 データ活用・展望
```

**完了後**: タスクをcompletedに変更

#### Step 2-3: 第3シート（構成図・フロー系）変換【3番目のタスクを in_progress に設定】

**出力ファイル**: `docs/result/[シート名3]_詳細フローチャート.md`

**必須含有要素**（構成図・フロー系シートの場合）:
```markdown
# [シート名3] - 詳細フローチャート分析

## 🔄 基本フローチャート
- 改善されたmermaidフローチャート

## 🎯 詳細プロセス分析
- サブグラフを使った詳細化

## 📈 データフロー図
- システム間連携図

## ⏱️ タイムライン処理フロー
- timeline図での時系列表現

## 🔧 エラーハンドリングフロー
- 例外処理フロー

## 📋 配置情報詳細
- Excel座標系での配置説明
```

**注意**: シートの内容が構成図・フロー以外の場合は、Step 2-1・2-2と同様の詳細分析形式を使用

**完了後**: タスクをcompletedに変更

---

### Phase 3: 総合分析レポート作成フェーズ

#### Step 3-1: 総合レポート作成【4番目のタスクを in_progress に設定】

**出力ファイル**: `docs/result/[Excelファイル名]_総合分析レポート.md`

**必須含有要素**:
```markdown
# [Excelファイル名].xlsx - 総合分析レポート

## 📋 エグゼクティブサマリー
## 👥 データプロファイル比較（複数シート間の比較）
## 📊 データ構造・履歴分析
## 💼 技術・業務スキル分析（該当する場合）
## 🏢 業界・分野特化分析
## 🎨 フローチャート・構成分析（図表シートがある場合）
## 📈 データ進展・変化パターン分析
## 🔍 戦略・活用分析
## 📊 定量分析結果
## 🚀 今後の展開・活用提案
## 📋 結論
```

**内容調整指針**:
- 経歴書以外のExcelファイルの場合、業務内容に応じてセクション名を調整
- 人材データでない場合は「データプロファイル比較」「業務フロー分析」等に変更
- 技術情報が含まれない場合は該当セクションを省略または調整

**重要なmermaid図**（内容に応じて選択・調整）:
- データプロファイル比較図
- 分野別・カテゴリ別分布（pie）
- 時系列変化タイムライン（timeline）
- ガントチャート（期間・スケジュール情報がある場合）
- データ構造・関係性分析（mindmap）
- フローチャート・プロセス図（flowchart）

**完了後**: タスクをcompletedに変更

---

## 📐 品質基準

### ドキュメント構造
- **ヘッダー階層**: 適切な#レベルの使用
- **絵文字活用**: 視認性向上のため各セクションにアイコン
- **表形式**: 比較データは必ず表形式で記載
- **コードブロック**: 技術情報は適切にマークアップ

### mermaid図の品質基準
```markdown
必須要素：
- スタイリング（fill, stroke, color指定）
- 適切な図表タイプの選択
  - flowchart: プロセスフロー
  - pie: 分布データ
  - timeline: 時系列データ
  - mindmap: 階層構造
  - gantt: スケジュール
  - graph: 関係図
- 日本語ラベルの適切な使用
```

### 内容の正確性
- **データの一貫性**: 全ドキュメント間での数値統一
- **技術用語**: 正確な技術表記
- **時系列**: 正確な期間計算（月数等）

---

## 🚨 注意事項

### 作業中の必須行動
1. **タスク管理**: 各フェーズでTodoWriteツールを必ず使用
2. **並行読み込み**: 複数ファイルは並行してRead実行
3. **段階的完了**: 1つのタスクが完了したら即座にcompletedに変更

### 避けるべき行動
- タスク管理なしでの作業開始
- 単一ファイルずつの逐次読み込み
- mermaid図なしでの図表表現
- 生データのコピー&ペーストのみ

---

## 🎯 成功指標

### 完了条件
**Phase 0（Excel解析）**:
- [ ] Excelファイルの拡張子変換完了
- [ ] zipファイルの展開完了
- [ ] excel_structure_analysis.mdの作成完了
- [ ] 各シートのXX_sheet.mdファイル作成完了
- [ ] 全Phase 0タスクがcompletedステータス

**Phase 1以降（Markdown変換）**:
- [ ] 4つの詳細markdownファイルが作成済み
- [ ] 各ファイルに適切なmermaid図が含まれている
- [ ] 人間が読みやすい構造化された内容
- [ ] 全タスクがcompletedステータス

### 品質チェックポイント
**Phase 0（Excel解析）**:
- [ ] ファイル拡張子変換の正確性
- [ ] zip展開の完全性（エラーなし）
- [ ] XML構造解析の正確性
- [ ] シートデータ抽出の完全性

**Phase 1以降（Markdown変換）**:
- [ ] データの数値的整合性
- [ ] mermaid図の視覚的品質
- [ ] 日本語表記の適切性
- [ ] 構造化された情報整理

---

## 🔄 実行コマンド例

### Phase 0開始時（Excel解析）
```markdown
TodoWriteツール実行：
[
  {"content": "Excelファイルの拡張子を.xlsxから.zipに変換", "status": "pending", "activeForm": "..."},
  {"content": "zipファイルをunzipして展開", "status": "pending", "activeForm": "..."},
  {"content": "展開されたディレクトリ構造を分析", "status": "pending", "activeForm": "..."},
  {"content": "excel_structure_analysis.mdを作成", "status": "pending", "activeForm": "..."},
  {"content": "各シートのXX_sheet.mdファイルを作成", "status": "pending", "activeForm": "..."}
]
```

### Phase 1開始時（Markdown変換）
```markdown
TodoWriteツール実行：
[
  {"content": "第1シートのデータを見やすいMarkdown形式で詳細整理", "status": "pending", "activeForm": "..."},
  {"content": "第2シートのデータを見やすいMarkdown形式で詳細整理", "status": "pending", "activeForm": "..."},
  {"content": "第3シート（構成図・フロー系）をmermaid形式で改善", "status": "pending", "activeForm": "..."},
  {"content": "全体のサマリーとプロジェクト分析ドキュメントを作成", "status": "pending", "activeForm": "..."}
]

※ 実際のシート名に置き換えて設定
※ シート数が3つ以外の場合は適宜調整
```

### ファイル読み込み（並行実行）
```markdown
Read: docs/20250927_001.md  # 基準ファイル（存在する場合）
Read: docs/result/excel_structure_analysis.md
Read: docs/result/[シート名1]_sheet.md
Read: docs/result/[シート名2]_sheet.md
Read: docs/result/[シート名3]_sheet.md
（上記を同一メッセージ内で並行実行）

※ 実際のシート名・ファイル名に置き換えて実行
```

### Excel解析フェーズ実行コマンド
```bash
# 拡張子変更
mv "*.xlsx" "*.zip"

# 展開
mkdir extracted_excel
unzip "*.zip" -d "extracted_excel/"

# 構造確認
ls -la extracted_excel/
ls -la extracted_excel/xl/worksheets/
```

### ファイル作成（Phase 0）
```markdown
Write: docs/result/excel_structure_analysis.md
Write: docs/result/[シート名1]_sheet.md
Write: docs/result/[シート名2]_sheet.md
Write: docs/result/[シート名3]_sheet.md
（各シート分、実際のシート名に置き換え）
```

### ファイル作成（Phase 1以降）
```markdown
Write: docs/result/[シート名1]_詳細.md
Write: docs/result/[シート名2]_詳細.md
Write: docs/result/[シート名3]_詳細フローチャート.md  # 構成図系の場合
Write: docs/result/[Excelファイル名]_総合分析レポート.md

※ 実際のシート名・ファイル名に置き換えて作成
```

---

## 📝 応用・カスタマイズ指針

### 他のExcelファイル対応時
1. **基準ファイル**: `docs/YYYYMMDD_NNN.md`を確認（存在する場合）
2. **Excel解析**: Phase 0の手順を必ず実行
3. **シート数**: 実際のシート数に応じてタスクを調整（1-10シート対応可能）
4. **データ種別**: 経歴書・売上データ・在庫管理・プロジェクト管理等、様々なデータ種別に対応
5. **ファイル命名**: 実際のシート名・ファイル名を使用（日本語・英数字両対応）
6. **内容調整**: データの性質に応じてセクション構成・分析観点を柔軟に調整

### データ種別別の対応例
- **人材・経歴書**: キャリア分析、スキル比較、成長パターン
- **売上・財務データ**: トレンド分析、業績比較、予測
- **在庫・物流データ**: 効率分析、最適化提案、フロー改善
- **プロジェクト管理**: 進捗分析、リソース配分、リスク評価
- **顧客データ**: セグメント分析、行動パターン、満足度評価

### 追加分析項目
- 技術トレンド分析
- リスク評価
- 競合比較
- ROI分析

### エラー対処法
**Excel解析フェーズでの一般的なエラー**:
- **拡張子変更失敗**: ファイル名にスペースや特殊文字が含まれる場合はクォートで囲む
- **zip展開失敗**: ファイルが破損していないか確認、権限チェック
- **XML読み込みエラー**: ファイルエンコーディングの確認
- **シート名文字化け**: 日本語シート名の場合はUTF-8で処理

**Markdown変換フェーズでのエラー**:
- **mermaid構文エラー**: 日本語ラベルの場合は適切にエスケープ
- **表形式の乱れ**: 列数の不整合をチェック
- **ファイル書き込み失敗**: 権限とディスク容量を確認

この指示書に従うことで、Excel解析から最終的なMarkdown変換まで、一貫した品質で作業を実行できます。