# 構成図 - 詳細フローチャート分析

## 🔄 基本フローチャート

### システム構成要素
描画XMLファイル（drawing1.xml）から抽出した図形要素：

| 要素ID | 図形種別 | テキスト | 位置情報 |
|--------|----------|----------|----------|
| 2 | 四角形（角丸） | 開始 | G3:J6 |
| 3 | 四角形（角丸） | 終了 | G31:J34 |
| 4 | 四角形（角丸） | 処理A | C17:F20 |
| 6 | 四角形（角丸） | 処理B | C23:F26 |
| 7 | 四角形（角丸） | 処理D | K23:O26 |
| 8 | 四角形（角丸） | 処理C | K17:O20 |
| 9 | 判断図形 | 今日？ | F9:K13 |
| 29 | 磁気ディスク | Oracle | P16:R21 |

### 改善されたMermaidフローチャート
```mermaid
flowchart TD
    A[開始] --> B{今日？}

    B -->|はい| C[処理A]
    B -->|いいえ| D[処理C]

    C --> E[処理B]
    D --> F[処理D]

    E --> G[終了]
    F --> G

    D --> H[(Oracle)]

    style A fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style G fill:#ffebee,stroke:#c62828,stroke-width:2px
    style B fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style H fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
```

## 🎯 詳細プロセス分析

### サブグラフによる詳細化
```mermaid
flowchart TD
    subgraph "メインプロセス"
        Start[開始] --> Decision{今日？}
    end

    subgraph "条件分岐処理"
        Decision -->|True| ProcessA[処理A<br/>- 当日処理<br/>- 即座実行]
        Decision -->|False| ProcessC[処理C<br/>- 通常処理<br/>- データ参照]
    end

    subgraph "後続処理"
        ProcessA --> ProcessB[処理B<br/>- 結果処理<br/>- 完了処理]
        ProcessC --> ProcessD[処理D<br/>- 拡張処理<br/>- 更新処理]
    end

    subgraph "データ層"
        ProcessC --> DB[(Oracle Database)]
        DB --> ProcessD
    end

    subgraph "終了処理"
        ProcessB --> End[終了]
        ProcessD --> End
    end

    style Start fill:#4caf50,color:#fff
    style End fill:#f44336,color:#fff
    style Decision fill:#ff9800,color:#fff
    style DB fill:#2196f3,color:#fff
```

## 📈 データフロー図

### システム間連携図
```mermaid
graph LR
    subgraph "入力層"
        Input[入力データ]
        Trigger[実行トリガー]
    end

    subgraph "判定層"
        DateCheck{日付判定<br/>今日？}
    end

    subgraph "処理層A"
        ProcA[処理A<br/>即座処理]
        ProcB[処理B<br/>完了処理]
    end

    subgraph "処理層B"
        ProcC[処理C<br/>データ処理]
        ProcD[処理D<br/>更新処理]
    end

    subgraph "データ層"
        Oracle[(Oracle DB)]
    end

    subgraph "出力層"
        Output[処理結果]
    end

    Input --> DateCheck
    Trigger --> DateCheck

    DateCheck -->|True| ProcA
    DateCheck -->|False| ProcC

    ProcA --> ProcB
    ProcC --> Oracle
    Oracle --> ProcD

    ProcB --> Output
    ProcD --> Output

    style DateCheck fill:#fff3e0,stroke:#e65100
    style Oracle fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
```

## ⏱️ タイムライン処理フロー

### 時系列での処理展開
```mermaid
timeline
    title システム処理タイムライン

    初期化 : 開始処理
           : システム起動
           : パラメータ設定

    判定フェーズ : 日付チェック
                : 今日？判定
                : 分岐決定

    処理フェーズA : 処理A実行
                  : 即座処理
                  : 処理B実行
                  : 完了処理

    処理フェーズB : 処理C実行
                  : データ参照
                  : Oracle接続
                  : 処理D実行

    終了フェーズ : 結果統合
                : 終了処理
                : システム停止
```

## 🔧 エラーハンドリングフロー

### 例外処理・エラー対応
```mermaid
flowchart TD
    Start[開始] --> Init[初期化]
    Init --> |成功| DateCheck{今日？}
    Init --> |失敗| Error1[初期化エラー]

    DateCheck --> |True| ProcA[処理A]
    DateCheck --> |False| ProcC[処理C]
    DateCheck --> |エラー| Error2[判定エラー]

    ProcA --> |成功| ProcB[処理B]
    ProcA --> |失敗| Error3[処理Aエラー]

    ProcC --> |成功| Oracle[(Oracle)]
    ProcC --> |失敗| Error4[処理Cエラー]

    Oracle --> |接続成功| ProcD[処理D]
    Oracle --> |接続失敗| Error5[DB接続エラー]

    ProcB --> |成功| End[正常終了]
    ProcB --> |失敗| Error6[処理Bエラー]

    ProcD --> |成功| End
    ProcD --> |失敗| Error7[処理Dエラー]

    Error1 --> ErrorEnd[異常終了]
    Error2 --> ErrorEnd
    Error3 --> Retry1[リトライ1]
    Error4 --> Retry2[リトライ2]
    Error5 --> DBFallback[DB代替処理]
    Error6 --> ErrorEnd
    Error7 --> ErrorEnd

    Retry1 --> |成功| ProcB
    Retry1 --> |失敗| ErrorEnd

    Retry2 --> |成功| Oracle
    Retry2 --> |失敗| ErrorEnd

    DBFallback --> End

    style Error1 fill:#ffcdd2,stroke:#d32f2f
    style Error2 fill:#ffcdd2,stroke:#d32f2f
    style Error3 fill:#fff3e0,stroke:#f57c00
    style Error4 fill:#fff3e0,stroke:#f57c00
    style Error5 fill:#ffcdd2,stroke:#d32f2f
    style ErrorEnd fill:#b71c1c,color:#fff
    style End fill:#4caf50,color:#fff
```

## 📋 配置情報詳細

### Excel座標系での配置説明

#### 図形配置マップ
| 図形 | Excel座標 | 実座標(twips) | サイズ | 説明 |
|------|-----------|---------------|--------|------|
| **開始** | G3:J6 | (3893820, 464820) | 2095500×449580 | フロー開始点 |
| **判定** | F9:K13 | (3611880, 1470660) | 2659380×548640 | 条件分岐 |
| **処理A** | C17:F20 | (1402080, 2796540) | 2095500×449580 | 左分岐処理 |
| **処理B** | C23:F26 | (1402080, 3832860) | 2095500×449580 | 左後続処理 |
| **処理C** | K17:O20 | (6549390, 2796540) | 2095500×449580 | 右分岐処理 |
| **処理D** | K23:O26 | (6549390, 3832860) | 2095500×449580 | 右後続処理 |
| **Oracle** | P16:R21 | (9433560, 2560320) | 1386840×922020 | データベース |
| **終了** | G31:J34 | (3893820, 5181600) | 2095500×449580 | フロー終点 |

#### 接続線情報
| 接続ID | 開始図形 | 終了図形 | 接続タイプ | 方向性 |
|--------|----------|----------|------------|--------|
| 11 | 開始(2) | 判定(9) | 直線矢印 | 下向き |
| 12 | 処理A(4) | 処理B(6) | 直線矢印 | 下向き |
| 15 | 処理C(8) | 処理D(7) | 直線矢印 | 下向き |
| 19 | 判定(9) | 処理A(4) | カギ線 | 左分岐 |
| 20 | 判定(9) | 処理C(8) | カギ線 | 右分岐 |
| 23 | 処理B(6) | 終了(3) | カギ線 | 中央収束 |
| 26 | 処理D(7) | 終了(3) | カギ線 | 中央収束 |
| 30 | 処理C(8) | Oracle(29) | 直線矢印 | 右向き |

### 設計パターン分析
- **分岐合流パターン**: 1つの判定から2つの処理パスに分岐し、最終的に1つの終了点に合流
- **データアクセスパターン**: 処理C→Oracle→処理D の順次データアクセスフロー
- **対称配置**: 左右対称の処理配置による視覚的バランス
- **階層構造**: 開始→判定→処理→終了の明確な階層レイアウト