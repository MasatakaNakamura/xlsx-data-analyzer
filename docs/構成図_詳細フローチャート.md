# 構成図シート - 詳細フローチャート分析

## 📊 概要

構成図シートには、業務プロセスを表現したフローチャートが含まれています。このドキュメントでは、そのフロー構造を詳細に分析し、複数のmermaid図形式で可視化します。

---

## 🔄 基本フローチャート

### メインプロセスフロー
```mermaid
flowchart TD
    Start([開始]) --> Decision{今日？}
    Decision -->|Yes| ProcessA[処理A]
    Decision -->|No| ProcessC[処理C]
    ProcessA --> ProcessB[処理B]
    ProcessC --> ProcessD[処理D]
    ProcessC --> Oracle[(Oracle)]
    ProcessB --> End([終了])
    ProcessD --> End

    %% スタイリング
    style Start fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    style End fill:#F44336,stroke:#C62828,stroke-width:3px,color:#fff
    style Decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    style ProcessA fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff
    style ProcessB fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff
    style ProcessC fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff
    style ProcessD fill:#9C27B0,stroke:#4A148C,stroke-width:2px,color:#fff
    style Oracle fill:#FF5722,stroke:#BF360C,stroke-width:3px,color:#fff

    %% ラベリング
    Start -.->|プロセス開始| Decision
    ProcessA -.->|左側処理ルート| ProcessB
    ProcessC -.->|右側処理ルート| ProcessD
    Oracle -.->|データベース連携| ProcessC
```

---

## 🎯 詳細プロセス分析

### 1. 判断分岐の詳細化
```mermaid
flowchart TD
    subgraph "初期判定フェーズ"
        Start([プロセス開始])
        Input[入力データ受信]
        Validate{データ検証}
        Decision{今日？}
    end

    subgraph "左側処理ルート（Yes）"
        ProcessA[処理A<br/>・データ整形<br/>・前処理実行]
        ProcessB[処理B<br/>・メイン処理<br/>・結果出力]
    end

    subgraph "右側処理ルート（No）"
        ProcessC[処理C<br/>・DB接続準備<br/>・クエリ生成]
        Oracle[(Oracle Database<br/>・データ取得<br/>・履歴更新)]
        ProcessD[処理D<br/>・DB処理結果<br/>・後処理実行]
    end

    subgraph "終了フェーズ"
        Merge{結果統合}
        Log[ログ出力]
        End([プロセス終了])
    end

    %% フロー接続
    Start --> Input
    Input --> Validate
    Validate -->|正常| Decision
    Validate -->|異常| End

    Decision -->|Yes<br/>当日処理| ProcessA
    Decision -->|No<br/>履歴処理| ProcessC

    ProcessA --> ProcessB
    ProcessB --> Merge

    ProcessC --> Oracle
    Oracle --> ProcessD
    ProcessD --> Merge

    Merge --> Log
    Log --> End

    %% スタイリング
    style Start fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    style End fill:#F44336,stroke:#C62828,stroke-width:3px,color:#fff
    style Decision fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    style Oracle fill:#FF5722,stroke:#BF360C,stroke-width:3px,color:#fff
    style Merge fill:#607D8B,stroke:#263238,stroke-width:2px,color:#fff
```

---

## 📈 データフロー図

### システム間データ連携
```mermaid
graph LR
    subgraph "外部システム"
        EXT1[外部API]
        EXT2[ファイルシステム]
        EXT3[メッセージキュー]
    end

    subgraph "メインシステム"
        START([開始])
        PROC_A[処理A]
        PROC_B[処理B]
        PROC_C[処理C]
        PROC_D[処理D]
        DECISION{今日？}
    end

    subgraph "データベース層"
        ORACLE[(Oracle DB)]
        CACHE[(キャッシュ)]
        LOG[(ログDB)]
    end

    subgraph "出力・結果"
        REPORT[レポート生成]
        NOTIFY[通知送信]
        FILE_OUT[ファイル出力]
    end

    %% データフロー
    EXT1 --> START
    EXT2 --> START
    EXT3 --> START

    START --> DECISION
    DECISION -->|Yes| PROC_A
    DECISION -->|No| PROC_C

    PROC_A --> CACHE
    PROC_A --> PROC_B
    PROC_B --> REPORT

    PROC_C --> ORACLE
    ORACLE --> PROC_D
    PROC_D --> FILE_OUT

    PROC_B --> LOG
    PROC_D --> LOG

    REPORT --> NOTIFY
    FILE_OUT --> NOTIFY

    %% スタイリング
    style ORACLE fill:#FF5722,stroke:#BF360C,stroke-width:3px,color:#fff
    style DECISION fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    style START fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
```

---

## ⏱️ タイムライン処理フロー

### 時系列処理パターン
```mermaid
timeline
    title 処理実行タイムライン

    section 初期化フェーズ
        00:00 : システム起動
              : 初期設定読み込み
        00:01 : 入力データ検証
              : ログ初期化

    section 判定フェーズ
        00:02 : 日付判定実行
              : ルート選択
        00:03 : 処理ルート確定

    section 実行フェーズ（Yes）
        00:04 : 処理A開始
              : データ前処理
        00:06 : 処理B開始
              : メイン処理実行
        00:10 : 結果出力

    section 実行フェーズ（No）
        00:04 : 処理C開始
              : DB接続確立
        00:05 : Oracle処理
              : データ取得・更新
        00:08 : 処理D開始
              : 後処理実行
        00:10 : ファイル出力

    section 終了フェーズ
        00:11 : 結果統合
              : ログ出力
        00:12 : システム終了
```

---

## 🔧 エラーハンドリングフロー

### 例外処理とリカバリ
```mermaid
flowchart TD
    Start([開始]) --> TryBlock{Try}

    TryBlock --> Decision{今日？}
    Decision -->|Yes| ProcessA[処理A]
    Decision -->|No| ProcessC[処理C]

    ProcessA --> ProcessB[処理B]
    ProcessC --> Oracle[(Oracle)]
    Oracle --> ProcessD[処理D]

    ProcessB --> Success[正常終了]
    ProcessD --> Success

    %% エラーハンドリング
    TryBlock -->|Exception| ErrorHandler{エラー判定}
    ProcessA -->|Error| ErrorHandler
    ProcessB -->|Error| ErrorHandler
    ProcessC -->|Error| ErrorHandler
    Oracle -->|DB Error| ErrorHandler
    ProcessD -->|Error| ErrorHandler

    ErrorHandler -->|軽微| Retry[リトライ処理]
    ErrorHandler -->|重大| Alert[アラート送信]
    ErrorHandler -->|致命的| Abort[処理中断]

    Retry --> TryBlock
    Alert --> Rollback[ロールバック]
    Abort --> Cleanup[クリーンアップ]

    Rollback --> Cleanup
    Cleanup --> End([異常終了])
    Success --> End2([正常終了])

    %% スタイリング
    style Start fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    style End fill:#F44336,stroke:#C62828,stroke-width:3px,color:#fff
    style End2 fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#fff
    style ErrorHandler fill:#FF5722,stroke:#BF360C,stroke-width:2px,color:#fff
    style Abort fill:#FF1744,stroke:#AD1457,stroke-width:3px,color:#fff
    style Alert fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#fff
    style Retry fill:#2196F3,stroke:#0D47A1,stroke-width:2px,color:#fff
```

---

## 📋 配置情報詳細

### Excel上の図形配置
```mermaid
graph TB
    subgraph "Excel座標系"
        subgraph "行3-6, 列G-J"
            START_POS[開始図形]
        end

        subgraph "行9-12, 列F-K"
            DECISION_POS{今日？}
        end

        subgraph "行17-20, 列C-F"
            PROC_A_POS[処理A]
        end

        subgraph "行23-26, 列C-F"
            PROC_B_POS[処理B]
        end

        subgraph "行17-20, 列K-N"
            PROC_C_POS[処理C]
        end

        subgraph "行23-26, 列K-N"
            PROC_D_POS[処理D]
        end

        subgraph "行16-21, 列P-R"
            ORACLE_POS[(Oracle)]
        end

        subgraph "行31-34, 列G-J"
            END_POS[終了]
        end
    end

    %% 接続線
    START_POS --> DECISION_POS
    DECISION_POS -.->|左カーブ| PROC_A_POS
    DECISION_POS -.->|右カーブ| PROC_C_POS
    PROC_A_POS --> PROC_B_POS
    PROC_C_POS --> PROC_D_POS
    PROC_C_POS -.->|横線| ORACLE_POS
    PROC_B_POS -.->|カーブ線| END_POS
    PROC_D_POS -.->|カーブ線| END_POS

    style START_POS fill:#e1f5fe
    style END_POS fill:#e1f5fe
    style DECISION_POS fill:#fff3e0
    style ORACLE_POS fill:#fce4ec
```

---

## 🎨 図形要素の説明

| 図形タイプ | 用途 | Excel配置 | 特徴 |
|-----------|------|-----------|------|
| **楕円形** | 開始・終了点 | G3:J6, G31:J34 | プロセスの起点・終点を示す |
| **ダイヤモンド** | 判断分岐 | F9:K12 | 条件分岐を表現 |
| **矩形** | 処理ブロック | C17:F20, C23:F26, K17:N20, K23:N26 | 各種処理ステップ |
| **円柱形** | データベース | P16:R21 | Oracle DBを表現 |
| **コネクタ** | フロー線 | 各図形間 | 処理の流れを示す矢印線 |

---

## 🔍 業務的解釈

### プロセスの意味
1. **「今日？」判定**: 当日処理か履歴処理かを判断
2. **処理A・B**: リアルタイム処理ルート（当日データ）
3. **処理C・D**: バッチ処理ルート（履歴データ、DB連携）
4. **Oracle連携**: データベースアクセスが必要な重要処理

### 実装パターン
- **条件分岐**: 日付ベースの処理ルート選択
- **並列処理**: 左右のルートは独立実行可能
- **データベース連携**: 右ルートでのみDB操作実行
- **統合終了**: 両ルートとも同一の終了点に収束